# AIRecipe Frontend

> åŸºäº Next.js 14 çš„ AI æ™ºèƒ½èœè°±ç”Ÿæˆå‰ç«¯åº”ç”¨

## é¡¹ç›®ç®€ä»‹

AIRecipe Frontend æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ Web åº”ç”¨ï¼Œé€šè¿‡è°ƒç”¨åç«¯ AI æœåŠ¡å®æ—¶ç”Ÿæˆç»“æ„åŒ–çš„ä¸­æ–‡èœè°±ã€‚é¡¹ç›®é‡‡ç”¨ **Feature-Based æ¶æ„**ï¼Œä½¿ç”¨ **Server-Sent Events (SSE)** å®ç°æµå¼è¾“å‡ºï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„èœè°±ç”Ÿæˆä½“éªŒã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **æµå¼ç”Ÿæˆä½“éªŒ** - é€šè¿‡ SSE å®æ—¶å±•ç¤º AI ç”Ÿæˆè¿‡ç¨‹
- ğŸ¯ **æ™ºèƒ½ JSON æ¸…ç†** - è‡ªåŠ¨å¤„ç† LLM è¾“å‡ºçš„ `<think>` æ ‡ç­¾å’Œ markdown æ ¼å¼
- ğŸ¨ **ç²¾ç¾èœè°±å±•ç¤º** - 4 æ ‡ç­¾é¡µå±•ç¤ºï¼ˆç”¨æ–™é€‰æã€çƒ¹é¥ªæ­¥éª¤ã€è¿›é˜¶æŠ€å·§ã€æ³¨æ„äº‹é¡¹ï¼‰
- ğŸ” **API Key è®¤è¯** - åŸºäº Cookie çš„å®‰å…¨è®¤è¯æœºåˆ¶
- ğŸ“¤ **å¤šç§å¯¼å‡ºæ–¹å¼** - æ”¯æŒå¤åˆ¶ JSONã€å¯¼å‡ºå›¾ç‰‡ã€æ‰“å°
- ğŸ“± **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯å‹å¥½çš„ç•Œé¢å¸ƒå±€
- â™¿ **æ— éšœç¢è®¿é—®** - å®Œæ•´çš„ ARIA æ ‡ç­¾å’Œé”®ç›˜å¯¼èˆªæ”¯æŒ

## æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js | 14.2.15 | React æ¡†æ¶ï¼ŒApp Router |
| React | 18.3.1 | UI ç»„ä»¶åº“ |
| TypeScript | 5.9.3 | ç±»å‹å®‰å…¨ |
| Tailwind CSS | 3.4.18 | åŸå­å¼ CSS æ¡†æ¶ |
| TanStack React Query | 5.90.5 | æœåŠ¡å™¨çŠ¶æ€ç®¡ç†ä¸ç¼“å­˜ |
| React Hook Form | 7.65.0 | è¡¨å•çŠ¶æ€ç®¡ç† |
| Zod | 4.1.12 | è¿è¡Œæ—¶ç±»å‹éªŒè¯ |
| Headless UI | 2.2.9 | æ— æ ·å¼å¯è®¿é—®ç»„ä»¶ |
| Lucide React | 0.546.0 | å›¾æ ‡åº“ |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18.17.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- pnpm 8.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
NEXT_PUBLIC_API_BASE_URL=http://localhost:8089
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

è®¿é—® http://localhost:8090

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx           # é¦–é¡µï¼ˆAPI Key éªŒè¯ï¼‰
â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ features/              # åŠŸèƒ½æ¨¡å—
â”‚   â””â”€â”€ recipe-generator/  # èœè°±ç”Ÿæˆæ¨¡å—
â”‚       â”œâ”€â”€ components/    # 16+ ä¸ªä¸“ç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ hooks/         # 4 ä¸ªè‡ªå®šä¹‰ Hook
â”‚       â”œâ”€â”€ types.ts       # TypeScript ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ schema.ts      # Zod éªŒè¯ schema
â”‚
â”œâ”€â”€ lib/                   # å·¥å…·åº“
â”‚   â”œâ”€â”€ api/              # API é€šä¿¡å±‚
â”‚   â”‚   â”œâ”€â”€ client.ts     # HTTP å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â””â”€â”€ recipes.ts    # èœè°± API æ¥å£
â”‚   â””â”€â”€ utils/            # å®ç”¨å·¥å…·
â”‚       â”œâ”€â”€ json-cleaner.ts  # JSON æ¸…ç†ä¸ä¿®å¤
â”‚       â”œâ”€â”€ cookie.ts        # Cookie ç®¡ç†
â”‚       â””â”€â”€ history.ts       # å†å²è®°å½•ç®¡ç†
â”‚
â”œâ”€â”€ components/            # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ ApiKeyInput.tsx   # API Key è¾“å…¥ç»„ä»¶
â”‚
â””â”€â”€ providers/             # React Context
    â””â”€â”€ query-client-provider.tsx  # React Query é…ç½®
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. èœè°±ç”Ÿæˆæµç¨‹

**ç”¨æˆ·è¾“å…¥** â†’ **è¡¨å•éªŒè¯** â†’ **SSE æµå¼è¯·æ±‚** â†’ **å®æ—¶æ˜¾ç¤º** â†’ **JSON æ¸…ç†** â†’ **ç±»å‹éªŒè¯** â†’ **ç»“æœå±•ç¤º**

### 2. ä¸»è¦ç»„ä»¶

| ç»„ä»¶ | èŒè´£ |
|------|------|
| `RecipeGeneratorScreen` | ä¸»ç¼–æ’å™¨ï¼Œç®¡ç†æ•´ä¸ªç”Ÿæˆæµç¨‹ |
| `HeroInput` | èœåè¾“å…¥ + æä¾›å•†é€‰æ‹© |
| `LoadingBanner` | SSE æµå¼å†…å®¹å®æ—¶æ˜¾ç¤º |
| `RecipeResult` | èœè°±ç»“æœå±•ç¤ºï¼ˆ4 æ ‡ç­¾é¡µï¼‰ |
| `RecipeMeta` | èœè°±å…ƒæ•°æ®å¤´ï¼ˆéš¾åº¦ã€æ—¶é—´ç­‰ï¼‰ |
| `RecipeIngredients` | é£Ÿæè¯¦æƒ…ï¼ˆä¸»æ–™ã€è¾…æ–™ã€è°ƒå‘³æ–™ï¼‰ |
| `RecipeSteps` | çƒ¹é¥ªæ­¥éª¤æ—¶é—´çº¿ |
| `RecipeTips` | è¿›é˜¶æŠ€å·§å¡ç‰‡ |
| `RecipeNotes` | æ³¨æ„äº‹é¡¹å±•ç¤º |
| `ExportModal` | å¯¼å‡ºé€‰é¡¹å¼¹çª— |

### 3. è‡ªå®šä¹‰ Hooks

| Hook | åŠŸèƒ½ |
|------|------|
| `useGenerateRecipeStream` | SSE æµå¼èœè°±ç”Ÿæˆ |
| `useRecipeProviders` | è·å– LLM æä¾›å•†åˆ—è¡¨ |
| `useRecipeHistory` | æœ¬åœ°å†å²è®°å½•ç®¡ç† |

### 4. API é€šä¿¡å±‚

æ‰€æœ‰ HTTP è¯·æ±‚é€šè¿‡ `apiFetch` å‡½æ•°ç»Ÿä¸€ç®¡ç†ï¼š

- è‡ªåŠ¨æ³¨å…¥ `X-API-Key` å¤´ï¼ˆä» Cookie è¯»å–ï¼‰
- åç«¯ snake_case â†” å‰ç«¯ camelCase è‡ªåŠ¨è½¬æ¢
- ç»Ÿä¸€é”™è¯¯å¤„ç†

## æ•°æ®æµæ¶æ„

### æµå¼ç”Ÿæˆæµç¨‹

```
ç”¨æˆ·è¾“å…¥èœå â†’ Zod éªŒè¯ â†’ startStream()
    â†“
POST /api/v1/recipes/generate/stream
    â†“
åç«¯ SSE æµå“åº”ï¼ˆdata: {...}\n\nï¼‰
    â†“
LoadingBanner å®æ—¶æ˜¾ç¤ºæµå†…å®¹
    â†“
[DONE] marker æ ‡è®°æµç»“æŸ
    â†“
safeParseRecipeJson() æ¸…ç†ä¸ä¿®å¤
    â”œâ”€ ç§»é™¤ <think> æ ‡ç­¾
    â”œâ”€ ç§»é™¤ markdown code blocks
    â”œâ”€ ç§»é™¤æ§åˆ¶å­—ç¬¦
    â””â”€ JSON.parse() æˆ– attemptJsonRepair()
    â†“
RecipeResultPreview ç±»å‹éªŒè¯
    â”œâ”€ éªŒè¯é€šè¿‡ â†’ RecipeResult å±•ç¤º
    â””â”€ éªŒè¯å¤±è´¥ â†’ æ˜¾ç¤ºåŸå§‹ JSON
```

### React Query ç¼“å­˜ç­–ç•¥

- **Queries**: å¤±è´¥é‡è¯• 1 æ¬¡ï¼ŒstaleTime 5 åˆ†é’Ÿï¼ŒgcTime 10 åˆ†é’Ÿ
- **Mutations**: ä¸é‡è¯•
- æä¾›å•†åˆ—è¡¨ç¼“å­˜ 10 åˆ†é’Ÿ


## é‡è¦æ³¨æ„äº‹é¡¹

### API Key è®¤è¯

- ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶éœ€æ‰‹åŠ¨è¾“å…¥ API Key
- API Key å­˜å‚¨åœ¨ Cookie ä¸­ï¼ˆæœ‰æ•ˆæœŸ 30 å¤©ï¼‰
- Cookie åç§°ï¼š`airecipe_api_key`

### Redis ç¼“å­˜ï¼ˆå¼€å‘è°ƒè¯•ï¼‰

åç«¯ä½¿ç”¨ Redis ç¼“å­˜èœè°±ç»“æœï¼Œç¼“å­˜ key åŸºäºèœåå’Œ providerã€‚

**æµ‹è¯•åŒä¸€èœåçš„æµå¼è¾“å‡ºæ—¶ï¼Œéœ€å…ˆæ¸…ç©º Redisï¼š**

```bash
redis-cli FLUSHALL
```

## å¯ç”¨è„šæœ¬

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm dev` | å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆTurbopackï¼‰ |
| `pnpm build` | ç”Ÿäº§æ„å»º |
| `pnpm start` | å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ |
| `pnpm lint` | è¿è¡Œ ESLint æ£€æŸ¥ |

